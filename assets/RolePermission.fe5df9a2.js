import{g as e,h as s,i,j as t}from"./sys.1ef09c51.js";import{x as o}from"./index.de78ff2b.js";import{p as r,a as c,b as l,Y as n,l as d,o as h,d as a,e as m,f as p,t as k,w as f}from"./vendor.cd5cedf3.js";const u={name:"RolePermission",props:{roleId:{type:Number,required:!0}},data:()=>({list:[],listb:[],treeProps:{children:"children",label:"name"},checkAllPermission:!1,checkedPermissions:[],loading:!1}),watch:{roleId(e,s){this.getPermissionsByRoleId()}},computed:{permissions(){const e=[];return this.listb.concat().map((s=>{e.push(s.id)})),e}},methods:{getPermissions(){return this.loading=!0,e().then((e=>{if(0===e.code){const s=e.data.list;s.map((e=>e.name=this.$t(e.name))),this.listb=s,this.list=o(s)}})).finally((()=>{this.loading=!1}))},getPermissionsByRoleId(){s({roleId:this.roleId}).then((e=>{if(0===e.code){let s=[];e.data.map((e=>{s.push(e.permissionId)})),this.checkedPermissions=s,this.$refs.tree.setCheckedKeys(s),s.length>=this.permissions.length?this.checkAllPermission=!0:this.checkAllPermission=!1}}))},submitForm(e){i({roleId:this.roleId}).then((e=>{if(0===e.code){const e=this.$refs.tree.getCheckedKeys(),s={roleId:this.roleId,permissionIds:e};t(s).then((e=>{0===e.code&&this.$message.success("保存成功,重新登录后生效")}))}}))},check(e,s){},resetForm(e){this.$refs[e].resetFields()},checkAll(){this.checkedPermissions=this.checkAllPermission?[]:this.permissions.concat(),this.checkAllPermission=!this.checkAllPermission,this.$refs.tree.setCheckedKeys(this.checkedPermissions)}},created(){this.getPermissions(),this.getPermissionsByRoleId()}},P=f();r("data-v-d0123cf4");const y={class:"footer"};c();const g=P(((e,s,i,t,o,r)=>{const c=l("el-button"),f=l("el-tree"),u=n("loading");return d((h(),a("div",null,[m(c,{size:"mini",type:o.checkAllPermission?"primary":null,onClick:s[1]||(s[1]=e=>r.checkAll()),icon:"el-icon-check"},{default:P((()=>[p(k(e.$t("全选")),1)])),_:1},8,["type"]),m(f,{data:o.list,"node-key":"id",ref:"tree","show-checkbox":"","default-expand-all":"",props:o.treeProps,"check-strictly":!0,"expand-on-click-node":!1,"check-on-click-node":!0,onCheck:r.check,style:{"margin-top":"20px"}},null,8,["data","props","onCheck"]),m("div",y,[m(c,{type:"primary",onClick:s[2]||(s[2]=e=>r.submitForm("form"))},{default:P((()=>[p(k(e.$t("提交")),1)])),_:1})])],512)),[[u,o.loading]])}));u.render=g,u.__scopeId="data-v-d0123cf4";export default u;
